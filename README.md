# Трассировка сетей

Модуль для автоматического отображения трассировки наружных инженерных систем по заданным точкам.

## Структура проекта

Проект разделен на `frontend` и `backend` согласно микросервисной архитектуре:

```
PP Project/
├── frontend/          # React приложение с Leaflet картой
├── backend/           # Node.js микросервисы
│   ├── gateway/       # API Gateway (порт 4000)
│   ├── tracing-service/  # Сервис трассировки (порт 4001)
│   └── rules-service/    # Сервис правил (порт 4002)
├── TZ/                # Техническое задание
└── docs/              # Документация (планируется)
```

## Что реализовано

### Frontend

#### ✅ Базовая инфраструктура
- React 18 + TypeScript
- Vite для сборки
- ESLint настроен
- Leaflet карта интегрирована

#### ✅ Все 6 систем трассировки из ТЗ

1. **Водоснабжение** (`water`)
   - ✅ Две линии (двойной трубопровод)
   - ✅ Расстояние между линиями: 1.8 м (в градусах для карты)
   - ✅ Цвет: синий (#0000ff)
   - ✅ Трасса с прямым углом 90°

2. **Канализация хоз-бытовая** (`sewerage`)
   - ✅ Одна линия
   - ✅ Минимальный угол 90° (без острых углов)
   - ✅ Цвет: коричневый (#8b4513)
   - ✅ Трасса с прямым углом 90°

3. **Ливневая канализация** (`storm`)
   - ✅ Одна линия
   - ✅ Минимальный угол 90° (без острых углов)
   - ✅ Цвет: темно-зеленый (#006400)
   - ✅ Трасса с прямым углом 90°

4. **Теплоснабжение** (`heating`)
   - ✅ Две линии (двойной трубопровод)
   - ✅ Расстояние между линиями: 1 м (в градусах для карты)
   - ✅ Цвет: красный (#ff0000)
   - ✅ Трасса с прямым углом 90°

5. **Электроснабжение** (`power`)
   - ✅ Одна линия
   - ✅ Трансформаторная подстанция (ТП) отображается как квадрат 6×6 м
   - ✅ Трасса автоматически привязывается к ближайшей стороне квадрата ТП
   - ✅ Цвет: розовый (#ff69b4)
   - ✅ Трасса с прямым углом 90°

6. **Сети связи** (`telecom`)
   - ✅ Одна линия
   - ✅ Трансформаторная подстанция (ТП) отображается как квадрат 6×6 м
   - ✅ Трасса автоматически привязывается к ближайшей стороне квадрата ТП
   - ✅ Цвет: желтый (#ffd700)
   - ✅ Трасса с прямым углом 90°

#### ✅ Функциональность трассировки
- ✅ Интерактивная карта Leaflet с OpenStreetMap тайлами
- ✅ Выбор двух точек кликом по карте (начальная и конечная)
- ✅ Автоматическое построение трассы с прямым углом 90°
- ✅ Визуализация двойных линий для водоснабжения и теплоснабжения
- ✅ Маркеры для начальной и конечной точек трасс
- ✅ Временный маркер при выборе первой точки
- ✅ Очистка всех трасс одной кнопкой
- ✅ Легенда с условными обозначениями всех систем
- ✅ Индикатор статуса (какая точка выбирается)

#### ✅ UI/UX
- ✅ Боковая панель с выбором типа системы
- ✅ Инструкции для пользователя
- ✅ Адаптивный дизайн
- ✅ Стилизация компонентов

### Backend

#### ✅ Микросервисная архитектура

1. **Gateway Service** (порт 4000)
   - ✅ Express сервер
   - ✅ CORS настроен
   - ✅ Единая точка входа: `POST /api/trace`
   - ✅ Проксирование запросов к tracing-service

2. **Tracing Service** (порт 4001)
   - ✅ Express сервер
   - ✅ Построение ортогональной трассы (90°)
   - ✅ Интеграция с rules-service
   - ✅ Конвертация расстояний в пиксели

3. **Rules Service** (порт 4002)
   - ✅ Express сервер
   - ✅ Хранение правил для всех 6 систем
   - ✅ API: `GET /rules/:system`
   - ✅ Возвращает: минимальный угол, двойная линия, расстояние в метрах

#### ✅ Конфигурация
- ✅ TypeScript для всех сервисов
- ✅ ESLint настроен
- ✅ package.json с зависимостями
- ✅ Скрипты для запуска сервисов

## Что не реализовано / Частично реализовано

### ❌ Интеграция Frontend ↔ Backend
- ❌ Frontend не использует backend API (все вычисления на клиенте)
- ❌ Нет запросов к gateway для построения трасс
- ❌ Backend работает независимо, но не используется

**Причина**: Frontend реализован как standalone приложение с локальной логикой трассировки. Backend готов к использованию, но не подключен.

### ❌ Требования из ТЗ

1. **Учет расстояний между системами по СП 42.13330.2016**
   - ❌ Не реализовано автоматическое соблюдение минимальных расстояний между разными инженерными системами
   - ❌ Нет проверки пересечений трасс разных систем
   - ❌ Нет валидации расстояний между параллельными трассами

2. **Визуализация зданий и магистралей**
   - ⚠️ Частично: есть условный квадрат ТП для электроснабжения/связи
   - ❌ Нет визуализации зданий (только точки клика)
   - ❌ Нет визуализации магистралей для водоснабжения, канализации, теплоснабжения
   - ❌ Нет возможности выбирать конкретное здание из списка

3. **Оптимизация трасс**
   - ❌ Нет алгоритма поиска оптимального пути (только прямой угол)
   - ❌ Нет учета препятствий на карте
   - ❌ Нет минимизации длины трассы

### ❌ Дополнительный функционал (не в ТЗ, но полезно)

1. **Сохранение/загрузка проектов**
   - ❌ Нет сохранения трасс в базу данных
   - ❌ Нет экспорта/импорта проектов
   - ❌ Нет истории изменений

2. **Редактирование трасс**
   - ❌ Нет возможности редактировать существующие трассы
   - ❌ Нет удаления отдельных трасс
   - ❌ Нет перемещения точек трасс

3. **База данных**
   - ❌ Нет подключения к БД (PostgreSQL, MongoDB и т.д.)
   - ❌ Нет моделей данных для трасс
   - ❌ Нет миграций

4. **Docker**
   - ❌ Нет Dockerfile для frontend
   - ❌ Нет Dockerfile для backend сервисов
   - ❌ Нет docker-compose.yml для оркестрации

5. **Документация**
   - ❌ Нет `docs/backend.md`
   - ❌ Нет `docs/frontend.md`
   - ❌ Нет API документации (Swagger/OpenAPI)

6. **Тестирование**
   - ❌ Нет unit тестов
   - ❌ Нет интеграционных тестов
   - ❌ Нет E2E тестов

7. **CI/CD**
   - ❌ Нет GitHub Actions / GitLab CI
   - ❌ Нет автоматической сборки Docker образов
   - ❌ Нет автоматического деплоя

## Как запустить

### Frontend

```bash
cd frontend
npm install
npm run dev
```

Приложение откроется на `http://localhost:5173`

### Backend

#### Запуск всех сервисов одновременно:

```bash
cd backend
npm install
npm run dev:all
```

#### Запуск отдельных сервисов:

```bash
# Gateway (порт 4000)
npm run dev:gateway

# Tracing Service (порт 4001)
npm run dev:tracing

# Rules Service (порт 4002)
npm run dev:rules
```

## Технологии

### Frontend
- React 18.3.1
- TypeScript 5.6.3
- Vite 5.4.0
- Leaflet 1.9.4
- react-leaflet 4.2.1

### Backend
- Node.js
- Express
- TypeScript
- axios (для межсервисного взаимодействия)
- cors

## Статус проекта

**Текущая версия**: MVP (Minimum Viable Product)

**Готовность**: ~70%

- ✅ Основной функционал трассировки реализован
- ✅ Все 6 систем из ТЗ работают
- ✅ UI/UX базовый, но функциональный
- ⚠️ Backend готов, но не интегрирован с frontend
- ❌ Требования по СП 42.13330.2016 не реализованы
- ❌ Нет сохранения данных
- ❌ Нет Docker контейнеризации

## Следующие шаги (рекомендации)

1. **Интеграция Frontend ↔ Backend**
   - Подключить frontend к gateway API
   - Перенести логику трассировки на backend

2. **Реализация требований СП 42.13330.2016**
   - Добавить проверку минимальных расстояний между системами
   - Реализовать валидацию пересечений

3. **База данных**
   - Подключить PostgreSQL или MongoDB
   - Создать модели для трасс и проектов

4. **Docker**
   - Создать Dockerfile для каждого сервиса
   - Настроить docker-compose.yml

5. **Документация**
   - Написать API документацию
   - Создать руководство пользователя

6. **Тестирование**
   - Написать unit тесты для критичных функций
   - Добавить E2E тесты для основных сценариев



